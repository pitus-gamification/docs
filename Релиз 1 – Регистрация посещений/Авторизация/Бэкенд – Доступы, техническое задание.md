- [1. Введение](#1-%D0%92%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5)
	- [1.1. Цель документа](#11-%D0%A6%D0%B5%D0%BB%D1%8C-%D0%B4%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D0%B0)
	- [1.2. Область применения](#12-%D0%9E%D0%B1%D0%BB%D0%B0%D1%81%D1%82%D1%8C-%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F)
- [2. Общее описание](#2-%D0%9E%D0%B1%D1%89%D0%B5%D0%B5-%D0%BE%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D0%B5)
	- [2.1. Перспектива продукта](#21-%D0%9F%D0%B5%D1%80%D1%81%D0%BF%D0%B5%D0%BA%D1%82%D0%B8%D0%B2%D0%B0-%D0%BF%D1%80%D0%BE%D0%B4%D1%83%D0%BA%D1%82%D0%B0)
	- [2.2. Основные функции модуля "Доступы"](#22-%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5-%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%B8-%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D1%8F-%D0%94%D0%BE%D1%81%D1%82%D1%83%D0%BF%D1%8B)
	- [2.3. Классы пользователей](#23-%D0%9A%D0%BB%D0%B0%D1%81%D1%81%D1%8B-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D0%B5%D0%B9)
- [3. Функциональные требования](#3-%D0%A4%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5-%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F)
	- [3.1. Управление назначением доступов](#31-%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BD%D0%B0%D0%B7%D0%BD%D0%B0%D1%87%D0%B5%D0%BD%D0%B8%D0%B5%D0%BC-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%BE%D0%B2)
		- [3.1.1. Назначение доступа пользователю](#311-%D0%9D%D0%B0%D0%B7%D0%BD%D0%B0%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8E)
		- [3.1.2. Удаление доступа с пользователя](#312-%D0%A3%D0%B4%D0%B0%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0-%D1%81-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F)
	- [3.2. Подготовка к будущему функционалу](#32-%D0%9F%D0%BE%D0%B4%D0%B3%D0%BE%D1%82%D0%BE%D0%B2%D0%BA%D0%B0-%D0%BA-%D0%B1%D1%83%D0%B4%D1%83%D1%89%D0%B5%D0%BC%D1%83-%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D0%BB%D1%83)
		- [3.2.1. Расширяемость модели данных](#321-%D0%A0%D0%B0%D1%81%D1%88%D0%B8%D1%80%D1%8F%D0%B5%D0%BC%D0%BE%D1%81%D1%82%D1%8C-%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D0%B8-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85)
		- [3.2.2. Интерфейсы для интеграции](#322-%D0%98%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81%D1%8B-%D0%B4%D0%BB%D1%8F-%D0%B8%D0%BD%D1%82%D0%B5%D0%B3%D1%80%D0%B0%D1%86%D0%B8%D0%B8)
		- [3.2.3. Добавление нового флоу авторизации через Telegram](#323-%D0%94%D0%BE%D0%B1%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BD%D0%BE%D0%B2%D0%BE%D0%B3%D0%BE-%D1%84%D0%BB%D0%BE%D1%83-%D0%B0%D0%B2%D1%82%D0%BE%D1%80%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D0%B8-%D1%87%D0%B5%D1%80%D0%B5%D0%B7-telegram)
- [4. Нефункциональные требования](#4-%D0%9D%D0%B5%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5-%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F)
	- [4.1. Безопасность](#41-%D0%91%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C)
	- [4.2. Производительность](#42-%D0%9F%D1%80%D0%BE%D0%B8%D0%B7%D0%B2%D0%BE%D0%B4%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE%D1%81%D1%82%D1%8C)
	- [4.3. Масштабируемость](#43-%D0%9C%D0%B0%D1%81%D1%88%D1%82%D0%B0%D0%B1%D0%B8%D1%80%D1%83%D0%B5%D0%BC%D0%BE%D1%81%D1%82%D1%8C)
	- [4.4. Надежность и отказоустойчивость](#44-%D0%9D%D0%B0%D0%B4%D0%B5%D0%B6%D0%BD%D0%BE%D1%81%D1%82%D1%8C-%D0%B8-%D0%BE%D1%82%D0%BA%D0%B0%D0%B7%D0%BE%D1%83%D1%81%D1%82%D0%BE%D0%B9%D1%87%D0%B8%D0%B2%D0%BE%D1%81%D1%82%D1%8C)
	- [4.5. Документирование](#45-%D0%94%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)
- [5. Требования к данным](#5-%D0%A2%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BA-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D0%BC)
	- [5.1. Модель данных](#51-%D0%9C%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85)
		- [Таблица `accesses`](#%D0%A2%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D0%B0-accesses)
		- [Таблица `user_accesses`](#%D0%A2%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D0%B0-user_accesses)
	- [5.2. Требования к базе данных](#52-%D0%A2%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BA-%D0%B1%D0%B0%D0%B7%D0%B5-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85)
- [6. Спецификация API](#6-%D0%A1%D0%BF%D0%B5%D1%86%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D1%8F-api)
	- [6.1. Эндпоинты для управления доступами](#61-%D0%AD%D0%BD%D0%B4%D0%BF%D0%BE%D0%B8%D0%BD%D1%82%D1%8B-%D0%B4%D0%BB%D1%8F-%D1%83%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0%D0%BC%D0%B8)
		- [6.1.1. Назначение доступа пользователю](#611-%D0%9D%D0%B0%D0%B7%D0%BD%D0%B0%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8E)
		- [6.1.2. Удаление доступа с пользователя](#612-%D0%A3%D0%B4%D0%B0%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0-%D1%81-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F)
	- [6.2. Эндпоинты для управления доступами (упрощенные)](#62-%D0%AD%D0%BD%D0%B4%D0%BF%D0%BE%D0%B8%D0%BD%D1%82%D1%8B-%D0%B4%D0%BB%D1%8F-%D1%83%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0%D0%BC%D0%B8-%D1%83%D0%BF%D1%80%D0%BE%D1%89%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5)
		- [6.2.1. Получение списка доступов](#621-%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D1%81%D0%BF%D0%B8%D1%81%D0%BA%D0%B0-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%BE%D0%B2)
		- [6.2.2. Получение информации о доступе](#622-%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B8%D0%BD%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D0%B8-%D0%BE-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B5)
		- [6.2.3. Получение текущих доступов пользователя](#623-%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D1%82%D0%B5%D0%BA%D1%83%D1%89%D0%B8%D1%85-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%BE%D0%B2-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F)
	- [6.3. Аутентификация и авторизация](#63-%D0%90%D1%83%D1%82%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D1%8F-%D0%B8-%D0%B0%D0%B2%D1%82%D0%BE%D1%80%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F)
- [7. Архитектурные решения](#7-%D0%90%D1%80%D1%85%D0%B8%D1%82%D0%B5%D0%BA%D1%82%D1%83%D1%80%D0%BD%D1%8B%D0%B5-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D1%8F)
	- [7.1. Сервисная архитектура](#71-%D0%A1%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%BD%D0%B0%D1%8F-%D0%B0%D1%80%D1%85%D0%B8%D1%82%D0%B5%D0%BA%D1%82%D1%83%D1%80%D0%B0)
	- [7.2. Подготовка к будущим функционалам](#72-%D0%9F%D0%BE%D0%B4%D0%B3%D0%BE%D1%82%D0%BE%D0%B2%D0%BA%D0%B0-%D0%BA-%D0%B1%D1%83%D0%B4%D1%83%D1%89%D0%B8%D0%BC-%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D0%BB%D0%B0%D0%BC)
- [8. Требования к безопасности](#8-%D0%A2%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BA-%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D0%B8)
- [9. Требования к тестированию](#9-%D0%A2%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BA-%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8E)
	- [9.1. Функциональное тестирование](#91-%D0%A4%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)
	- [9.2. Нагрузочное тестирование](#92-%D0%9D%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BE%D1%87%D0%BD%D0%BE%D0%B5-%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)
	- [9.3. Безопасностное тестирование](#93-%D0%91%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D0%BD%D0%BE%D0%B5-%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)
- [10. План реализации](#10-%D0%9F%D0%BB%D0%B0%D0%BD-%D1%80%D0%B5%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D0%B8)
	- [10.1. Этапы проекта](#101-%D0%AD%D1%82%D0%B0%D0%BF%D1%8B-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B0)
	- [10.2. Сроки и ресурсы](#102-%D0%A1%D1%80%D0%BE%D0%BA%D0%B8-%D0%B8-%D1%80%D0%B5%D1%81%D1%83%D1%80%D1%81%D1%8B)
- [11. Дополнительные замечания](#11-%D0%94%D0%BE%D0%BF%D0%BE%D0%BB%D0%BD%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5-%D0%B7%D0%B0%D0%BC%D0%B5%D1%87%D0%B0%D0%BD%D0%B8%D1%8F)
	- [**Инициальный список доступов**](#%D0%98%D0%BD%D0%B8%D1%86%D0%B8%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9-%D1%81%D0%BF%D0%B8%D1%81%D0%BE%D0%BA-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%BE%D0%B2)

## 1. Введение

### 1.1. Цель документа

Определить требования и спецификации для разработки бэкенд-функционала модуля **"Доступы"** в рамках первого релиза цифрового сервиса по автоматизации системы регистрации посещений мероприятий в университете.

### 1.2. Область применения

Документ предназначен для команды разработчиков бэкенда и тестировщиков, участвующих в реализации модуля **"Доступы"**.

---

## 2. Общее описание

### 2.1. Перспектива продукта

Модуль **"Доступы"** обеспечивает управление доступами пользователей системы. Он позволяет назначать и удалять доступы пользователям для контроля доступа к различным функциям системы. Доступы проектируются заранее и не могут быть созданы или удалены через систему. Модуль интегрируется с модулем **"Авторизация"**, обеспечивая гибкую и масштабируемую систему управления доступом.

### 2.2. Основные функции модуля "Доступы"

- Назначение доступов пользователям.
- Удаление доступов с пользователей.
- Хранение и организация доступов для различных действий и ресурсов.
- Поддержка гибкой системы управления доступом без фиксированных ролей.
- Подготовка к интеграции с будущими модулями и функционалом.

### 2.3. Классы пользователей

**Классы пользователей** являются отражением реального бизнес процесса, но в коде все пользователи равны и система оперирует исключительно доступами.

- **Администраторы:** Имеют право управлять доступами и назначать их пользователям.
- **Модераторы:** Могут обладать определенными доступами, связанными с проведением мероприятий.
- **Студенты:** Обычно обладают минимальными доступами, необходимыми для участия в мероприятиях и управления своими данными.

---

## 3. Функциональные требования

### 3.1. Управление назначением доступов

#### 3.1.1. Назначение доступа пользователю

- **Описание:** Администратор назначает один или несколько доступов пользователю для контроля доступа к функционалу системы.
- **Требования:**
  - Выбор **user_id** и **access_enum**.
  - Добавление записи в таблицу `user_accesses`.
  - Проверка существования пользователя и доступа перед назначением.
  - Обработка ошибок при попытке назначить уже существующий доступ.
  - Интеграция с системой авторизации для обеспечения корректного контроля доступа.

#### 3.1.2. Удаление доступа с пользователя

- **Описание:** Администратор удаляет один или несколько доступов с пользователя.
- **Требования:**
  - Выбор **user_id** и **access_enum**.
  - Удаление записи из таблицы `user_accesses`.
  - Проверка существования пользователя и доступа перед удалением.
  - Обработка ошибок при попытке удалить несуществующий доступ.

### 3.2. Подготовка к будущему функционалу

#### 3.2.1. Расширяемость модели данных

- **Описание:** Модель данных должна быть спроектирована с учетом будущего добавления функционала, такого как многоуровневая система доступов или дополнительные методы аутентификации.
- **Требования:**
  - Предусмотреть возможность добавления новых доступов заранее без необходимости изменения структуры базы данных.
  - Использовать стандартизированные методы именования и типы данных для облегчения расширения.
  - Обеспечить нормализацию базы данных для предотвращения избыточности данных.

#### 3.2.2. Интерфейсы для интеграции

- **Описание:** API должны быть разработаны с учетом возможного расширения функционала и интеграции с другими модулями.
- **Требования:**
  - Использовать RESTful архитектуру для API.
  - Документировать API с учетом будущих расширений.
  - Обеспечить версионирование API для поддержки изменений в будущем.

#### 3.2.3. Добавление нового флоу авторизации через Telegram

- **Описание:** Реализовать дополнительный метод авторизации через Telegram, используя хэш для логина и возвращая необходимые учетные данные.
- **Требования:**
  - Разработка эндпоинта для инициации авторизации через Telegram.
  - Обработка хэшей, полученных от Telegram, для аутентификации пользователей.
  - Назначение соответствующих доступов пользователям после успешной авторизации.
  - Интеграция этого флоу с системой доступов для контроля доступа.
  - Контроль доступа к этому флоу через систему доступов.

---

## 4. Нефункциональные требования

### 4.1. Безопасность

- **Аутентификация и авторизация:**
  - Использовать надежные методы аутентификации (например, JWT).
  - Реализовать систему доступов для контроля доступа (**доступы**).
- **Защита данных:**
  - Шифрование данных при передаче (SSL/TLS).
  - Хранение паролей в зашифрованном виде (например, с использованием bcrypt).
  - Соответствие требованиям законодательства о защите персональных данных (например, GDPR).
- **Защита от атак:**
  - Реализовать защиту от распространенных веб-атак (SQL-инъекции, XSS, CSRF и т.д.).
  - Ограничить количество попыток входа для предотвращения атак грубой силы.

### 4.2. Производительность

- **Время отклика:** Не более 2 секунд для основных операций.
- **Нагрузка:** Способность обрабатывать стандартную нагрузку системы с возможностью масштабирования.

### 4.3. Масштабируемость

- **Архитектура:**
  - Модульная архитектура, позволяющая легко добавлять новый функционал.
  - Возможность горизонтального и вертикального масштабирования системы.

### 4.4. Надежность и отказоустойчивость

- **Доступность:** Система должна быть доступна не менее 99.9% времени.
- **Резервное копирование:** Регулярное резервное копирование базы данных.
- **Восстановление после сбоев:** Быстрое восстановление системы в случае непредвиденных сбоев.

### 4.5. Документирование

- **Код и API:**
  - Подробная документация кода для облегчения понимания и поддержки.
  - Документация API (например, с использованием Swagger/OpenAPI).

---

## 5. Требования к данным

### 5.1. Модель данных

#### Таблица `accesses`

| Поле        | Тип данных | Описание                                                     | Ограничения                      |
|-------------|------------|--------------------------------------------------------------|----------------------------------|
| access_enum | ENUM       | Перечисление доступов (например, `CREATE_EVENT`, `DELETE_USER`) | Primary Key, Unique, Not Null    |

- **Примечание:** Таблица `accesses` содержит заранее определенный список доступов, которые не могут быть созданы или удалены через систему. Эти доступы используются при разработке модулей для определения, какие действия ограничивать и кому предоставлять доступ.

#### Таблица `user_accesses`

| Поле        | Тип данных | Описание                                 | Ограничения                                               |
|-------------|------------|------------------------------------------|-----------------------------------------------------------|
| user_id     | UUID       | Идентификатор пользователя               | Foreign Key (ссылается на `users.user_id`), Not Null       |
| access_enum | ENUM       | Перечисление доступов                    | Foreign Key (ссылается на `accesses.access_enum`), Not Null |
| created_at  | TIMESTAMP  | Дата и время назначения доступа          | Default: CURRENT_TIMESTAMP                                |
| updated_at  | TIMESTAMP  | Дата и время последнего изменения доступа| Default: CURRENT_TIMESTAMP ON UPDATE                      |

- **Примечание:** Таблица `user_accesses` реализует связь многие-ко-многим между пользователями и доступами. Поля `created_at` и `updated_at` добавлены для отслеживания времени назначения и изменения доступов.

### 5.2. Требования к базе данных

- **Производительность:**
  - Оптимизация запросов и использование индексов на часто используемых полях (например, `access_enum`).
  - Использование индексов на полях `user_id` и `access_enum` в таблице `user_accesses` для ускорения операций назначения доступов.
  
- **Целостность данных:**
  - Обеспечение ссылочной целостности между таблицами `users`, `accesses` и `user_accesses`.
  - Настройка ограничений на уровне базы данных для предотвращения дублирования доступов и назначений.
  
- **Безопасность:**
  - Ограничение доступа к таблицам `accesses` и `user_accesses` только для сервисов, отвечающих за управление доступами.
  - Использование ролевых схем безопасности базы данных для разделения прав доступа.

---

## 6. Спецификация API

### 6.1. Эндпоинты для управления доступами

#### 6.1.1. Назначение доступа пользователю

- **Метод:** POST
- **URL:** `/api/v1/accesses/assign`
- **Заголовки:**
  - `Authorization: Bearer <access_token>`
  - `Content-Type: application/json`
- **Тело запроса:**
  ```json
  {
    "user_id": "uuid_user",
    "access_enum": "CREATE_EVENT"
  }
  ```
- **Ответ:**
  - **200 OK**
  ```json
  {
    "user_id": "uuid_user",
    "assigned_accesses": ["CREATE_EVENT", "DELETE_USER"]
  }
  ```
  - **400 Bad Request** (если доступ уже назначен пользователю)
  ```json
  {
    "error": "Доступ уже назначен этому пользователю."
  }
  ```
  - **404 Not Found** (если пользователь или доступ не найдены)
  ```json
  {
    "error": "Пользователь или доступ не найдены."
  }
  ```

#### 6.1.2. Удаление доступа с пользователя

- **Метод:** DELETE
- **URL:** `/api/v1/accesses/unassign`
- **Заголовки:**
  - `Authorization: Bearer <access_token>`
  - `Content-Type: application/json`
- **Тело запроса:**
  ```json
  {
    "user_id": "uuid_user",
    "access_enum": "CREATE_EVENT"
  }
  ```
- **Ответ:**
  - **204 No Content**
  - **404 Not Found** (если пользователь или доступ не найдены или доступ не назначен пользователю)
  ```json
  {
    "error": "Доступ не назначен этому пользователю или пользователь/доступ не найдены."
  }
  ```

### 6.2. Эндпоинты для управления доступами (упрощенные)

#### 6.2.1. Получение списка доступов

- **Метод:** GET
- **URL:** `/api/v1/accesses`
- **Заголовки:**
  - `Authorization: Bearer <access_token>`
- **Параметры запроса (опционально):**
  - `access_enum` — фильтрация по типу доступа.
  - `sort` — сортировка результатов (например, по `access_enum`).
- **Требования к доступу:** Пользователь должен обладать доступом `MANAGE_ACCESSES`.
- **Ответ:**
  - **200 OK**
  ```json
  [
    {
      "access_enum": "CREATE_EVENT"
    },
    {
      "access_enum": "DELETE_USER"
    }
    // ... другие доступы
  ]
  ```
  - **403 Forbidden** (если пользователь не обладает необходимым доступом)
  ```json
  {
    "error": "Недостаточно прав для выполнения этого запроса."
  }
  ```

#### 6.2.2. Получение информации о доступе

- **Метод:** GET
- **URL:** `/api/v1/accesses/{access_enum}`
- **Заголовки:**
  - `Authorization: Bearer <access_token>`
- **Ответ:**
  - **200 OK**
  ```json
  {
    "access_enum": "CREATE_EVENT"
  }
  ```
  - **404 Not Found** (если доступ не найден или пользователь не обладает необходимым доступом)
  ```json
  {
    "error": "Доступ не найден."
  }
  ```

#### 6.2.3. Получение текущих доступов пользователя

- **Метод:** GET
- **URL:** `/api/v1/users/{user_id}/accesses`
- **Заголовки:**
  - `Authorization: Bearer <access_token>`
- **Ответ:**
  - **200 OK**
  ```json
  {
    "user_id": "uuid_user",
    "accesses": ["CREATE_EVENT", "DELETE_USER"]
  }
  ```
  - **404 Not Found** (если пользователь не найден)
  ```json
  {
    "error": "Пользователь не найден."
  }
  ```
  - **403 Forbidden** (если текущий пользователь не имеет права просматривать доступы других пользователей)
  ```json
  {
    "error": "Недостаточно прав для выполнения этого запроса."
  }
  ```

### 6.3. Аутентификация и авторизация

- **Описание:** Все эндпоинты модуля **"Доступы"** защищены механизмами аутентификации и авторизации, предоставляемыми модулем **"Авторизация"**. Доступ к эндпоинтам осуществляется только пользователям с соответствующими доступами (например, `MANAGE_ACCESSES`).

---

## 7. Архитектурные решения

### 7.1. Сервисная архитектура

- **Модульность:** Модуль **"Доступы"** разработан как отдельный сервис, который взаимодействует с другими модулями через API. Это обеспечивает независимость и облегчает масштабирование.
- **Стандарты:** Соблюдение RESTful стандартов при разработке API. Использование стандартных методов HTTP (GET, POST, DELETE).

### 7.2. Подготовка к будущим функционалам

- **Многоуровневая система доступов:**
  - Предусмотреть возможность добавления дополнительных уровней доступов и гибкой настройки доступа.
  - Обеспечить гибкость в управлении доступами через административный интерфейс или конфигурационные файлы.
- **Методы аутентификации:**
  - Возможность добавления альтернативных методов аутентификации (например, OAuth, SSO) без значительных изменений в архитектуре.
- **Интеграция с новым флоу авторизации через Telegram:**
  - Обеспечить, чтобы назначение доступов через Telegram соответствовало общей системе управления доступами.
  - Интегрировать этот флоу с существующей системой доступов для контроля доступа.

---

## 8. Требования к безопасности

- **Аутентификация и авторизация:**
  - Реализовать механизмы проверки прав доступа для каждого эндпоинта.
  - Ограничить доступ к эндпоинтам **"Доступы"** только для пользователей с соответствующими доступами (например, `MANAGE_ACCESSES`).
- **Шифрование данных:**
  - Обеспечить шифрование всех передаваемых данных с использованием SSL/TLS.
  - Хранить чувствительные данные (например, пароли) в зашифрованном виде с использованием современных алгоритмов хеширования (например, bcrypt).
- **Защита от атак:**
  - Реализовать защиту от распространенных веб-атак (SQL-инъекции, XSS, CSRF и т.д.).
  - Ограничить количество попыток выполнения операций для предотвращения атак грубой силы.
- **Логирование и аудит:**
  - Вести журналы всех операций по управлению доступами и назначению их пользователям.
  - Обеспечить защиту журналов от несанкционированного доступа и изменений.

---

## 9. Требования к тестированию

### 9.1. Функциональное тестирование

- **Тестирование назначений доступов:**
  - Проверка корректности назначения доступов пользователям.
  - Проверка корректности удаления доступов с пользователей.
- **Тестирование бизнес-логики:**
  - Проверка уникальности доступов.
  - Проверка ограничения назначения доступов, если это необходимо.
- **Тестирование ошибок и исключений:**
  - Обработка некорректных данных.
  - Обработка попыток доступа без необходимых доступов.

### 9.2. Нагрузочное тестирование

- **Производительность:**
  - Проверка времени отклика системы под стандартной и повышенной нагрузкой.
  - Оценка устойчивости системы к пиковым нагрузкам.
- **Масштабируемость:**
  - Проверка работы системы при увеличении объема данных (например, большое количество доступов и назначений).

### 9.3. Безопасностное тестирование

- **Тестирование на уязвимости:**
  - SQL-инъекции, XSS, CSRF и другие распространенные веб-атаки.
- **Проверка механизмов аутентификации и авторизации:**
  - Убедиться, что только авторизованные пользователи с соответствующими доступами имеют доступ к эндпоинтам.
- **Тестирование шифрования данных:**
  - Проверка безопасности передачи и хранения данных.
- **Тестирование защиты от атак грубой силы:**
  - Проверка ограничения количества попыток выполнения операций.

---

## 10. План реализации

### 10.1. Этапы проекта

1. **Проектирование:**
   - Разработка модели данных для управления доступами и их назначениями.
   - Определение структуры API и схемы взаимодействия с другими модулями.
2. **Разработка:**
   - Реализация эндпоинтов для назначения и удаления доступов.
   - Реализация эндпоинта для получения текущих доступов пользователя.
   - Интеграция с модулем **"Авторизация"** для проверки доступов.
   - Интеграция метода авторизации через Telegram с учетом системы доступов.
3. **Тестирование:**
   - Функциональное тестирование всех компонентов модуля.
   - Нагрузочное тестирование для оценки производительности.
   - Безопасностное тестирование для выявления и устранения уязвимостей.
4. **Документирование:**
   - Подготовка технической документации для разработчиков.
   - Документирование API (например, с использованием Swagger/OpenAPI).
5. **Внедрение:**
   - Развертывание модуля на сервере.
   - Проведение необходимых настроек и интеграция с другими модулями.
   - Проведение обучающих сессий для команды поддержки.

### 10.2. Сроки и ресурсы

- **Предварительные сроки:**
  - Общая продолжительность разработки модуля **"Доступы"**: 2-3 недели.
- **Команда проекта:**
  - **Backend-разработчики:** 2 человека.
  - **Тестировщики:** 1-2 человека.
  - **Бизнес-аналитик:** 1 человек (при необходимости для уточнения требований).
  - **Специалист по безопасности:** 1 человек (при необходимости для проведения безопасностного тестирования).

---

## 11. Дополнительные замечания

- **Качество кода:** Следование принципам чистого кода и код-стайлу команды для облегчения поддержки и дальнейшего развития модуля.
- **Обратная связь:** Регулярные встречи команды для обсуждения прогресса, возникающих вопросов и потенциальных улучшений.
- **Риски:**
  - Возможные изменения требований со стороны стейкхолдеров.
  - Задержки в интеграции с другими модулями системы.
  - Уязвимости безопасности, обнаруженные в процессе тестирования.
- **Взаимодействие с другими модулями:**
  - Обеспечить стабильное и безопасное взаимодействие с модулями **"Авторизация"**, **"Пользователи"**, **"Админ. приложение"**, **"Сканнер"** и **"MiniApp"**.
  - Предусмотреть механизм передачи информации о доступах пользователей для обеспечения корректной авторизации в других модулях.

---

### **Инициальный список доступов**

Предварительно разработанный список доступов, которые будут использоваться в системе:

1. `MANAGE_USERS` — Управление пользователями.
2. `CREATE_EVENT` — Просмотр мероприятий.
3. `DELETE_EVENT` — Управление мероприятиями.
4. `MANAGE_ACCESSES` — Управление доступами.
5. `VERIFY_PARTICIPANTS` — Верификация участников.
6. `VIEW_REPORTS` — Просмотр отчетов.
7. `UPGRADE_USERS` — Повышение аккаунта (upgrade).
8. `ACCESS_TELEGRAM_AUTH` — Доступ к авторизации через Telegram.

- **Примечание:** Этот список является фиксированным и не может быть изменен через систему. Все доступы должны быть четко определены и согласованы с бизнес-требованиями. При добавлении нового функционала необходимо предварительно определить и добавить соответствующие доступы в этот список.