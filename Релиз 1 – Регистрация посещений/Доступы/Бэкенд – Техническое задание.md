- [1. Введение](#1-%D0%92%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5)
	- [1.1. Цель документа](#11-%D0%A6%D0%B5%D0%BB%D1%8C-%D0%B4%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D0%B0)
	- [1.2. Область применения](#12-%D0%9E%D0%B1%D0%BB%D0%B0%D1%81%D1%82%D1%8C-%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F)
- [2. Общее описание](#2-%D0%9E%D0%B1%D1%89%D0%B5%D0%B5-%D0%BE%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D0%B5)
	- [2.1. Перспектива продукта](#21-%D0%9F%D0%B5%D1%80%D1%81%D0%BF%D0%B5%D0%BA%D1%82%D0%B8%D0%B2%D0%B0-%D0%BF%D1%80%D0%BE%D0%B4%D1%83%D0%BA%D1%82%D0%B0)
	- [2.2. Основные функции модуля "Доступы"](#22-%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5-%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%B8-%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D1%8F-%D0%94%D0%BE%D1%81%D1%82%D1%83%D0%BF%D1%8B)
	- [2.3. Классы пользователей](#23-%D0%9A%D0%BB%D0%B0%D1%81%D1%81%D1%8B-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D0%B5%D0%B9)
- [3. Функциональные требования](#3-%D0%A4%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5-%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F)
	- [3.1. Управление назначением доступов](#31-%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BD%D0%B0%D0%B7%D0%BD%D0%B0%D1%87%D0%B5%D0%BD%D0%B8%D0%B5%D0%BC-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%BE%D0%B2)
		- [3.1.1. Назначение доступа пользователю](#311-%D0%9D%D0%B0%D0%B7%D0%BD%D0%B0%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8E)
		- [3.1.2. Удаление доступа с пользователя](#312-%D0%A3%D0%B4%D0%B0%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0-%D1%81-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F)
	- [3.2. Интеграция с другими модулями](#32-%D0%98%D0%BD%D1%82%D0%B5%D0%B3%D1%80%D0%B0%D1%86%D0%B8%D1%8F-%D1%81-%D0%B4%D1%80%D1%83%D0%B3%D0%B8%D0%BC%D0%B8-%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D1%8F%D0%BC%D0%B8)
- [4. Нефункциональные требования](#4-%D0%9D%D0%B5%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5-%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F)
	- [4.1. Безопасность](#41-%D0%91%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C)
	- [4.2. Производительность](#42-%D0%9F%D1%80%D0%BE%D0%B8%D0%B7%D0%B2%D0%BE%D0%B4%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE%D1%81%D1%82%D1%8C)
	- [4.3. Масштабируемость](#43-%D0%9C%D0%B0%D1%81%D1%88%D1%82%D0%B0%D0%B1%D0%B8%D1%80%D1%83%D0%B5%D0%BC%D0%BE%D1%81%D1%82%D1%8C)
	- [4.4. Надежность и отказоустойчивость](#44-%D0%9D%D0%B0%D0%B4%D0%B5%D0%B6%D0%BD%D0%BE%D1%81%D1%82%D1%8C-%D0%B8-%D0%BE%D1%82%D0%BA%D0%B0%D0%B7%D0%BE%D1%83%D1%81%D1%82%D0%BE%D0%B9%D1%87%D0%B8%D0%B2%D0%BE%D1%81%D1%82%D1%8C)
	- [4.5. Документирование](#45-%D0%94%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)
- [5. Требования к данным](#5-%D0%A2%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BA-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D0%BC)
	- [5.1. Модель данных](#51-%D0%9C%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85)
		- [Таблица `accesses`](#%D0%A2%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D0%B0-accesses)
		- [Таблица `user_accesses`](#%D0%A2%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D0%B0-user_accesses)
	- [5.2. Требования к базе данных](#52-%D0%A2%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BA-%D0%B1%D0%B0%D0%B7%D0%B5-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85)
- [6. Спецификация API](#6-%D0%A1%D0%BF%D0%B5%D1%86%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D1%8F-api)
	- [6.1. Эндпоинты для управления доступами](#61-%D0%AD%D0%BD%D0%B4%D0%BF%D0%BE%D0%B8%D0%BD%D1%82%D1%8B-%D0%B4%D0%BB%D1%8F-%D1%83%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0%D0%BC%D0%B8)
		- [6.1.1. Назначение доступа пользователю](#611-%D0%9D%D0%B0%D0%B7%D0%BD%D0%B0%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8E)
		- [6.1.2. Удаление доступа с пользователя](#612-%D0%A3%D0%B4%D0%B0%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0-%D1%81-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F)
	- [6.2. Эндпоинты для получения информации о доступах](#62-%D0%AD%D0%BD%D0%B4%D0%BF%D0%BE%D0%B8%D0%BD%D1%82%D1%8B-%D0%B4%D0%BB%D1%8F-%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D1%8F-%D0%B8%D0%BD%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D0%B8-%D0%BE-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0%D1%85)
		- [6.2.1. Получение списка доступов](#621-%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D1%81%D0%BF%D0%B8%D1%81%D0%BA%D0%B0-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%BE%D0%B2)
		- [6.2.2. Получение информации о доступе](#622-%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B8%D0%BD%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D0%B8-%D0%BE-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B5)
		- [6.2.3. Получение текущих доступов пользователя](#623-%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D1%82%D0%B5%D0%BA%D1%83%D1%89%D0%B8%D1%85-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%BE%D0%B2-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F)
	- [6.3. Аутентификация и авторизация](#63-%D0%90%D1%83%D1%82%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D1%8F-%D0%B8-%D0%B0%D0%B2%D1%82%D0%BE%D1%80%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F)
- [7. Архитектурные решения](#7-%D0%90%D1%80%D1%85%D0%B8%D1%82%D0%B5%D0%BA%D1%82%D1%83%D1%80%D0%BD%D1%8B%D0%B5-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D1%8F)
	- [7.1. Модульная архитектура](#71-%D0%9C%D0%BE%D0%B4%D1%83%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F-%D0%B0%D1%80%D1%85%D0%B8%D1%82%D0%B5%D0%BA%D1%82%D1%83%D1%80%D0%B0)
	- [7.2. Интеграция с другими модулями](#72-%D0%98%D0%BD%D1%82%D0%B5%D0%B3%D1%80%D0%B0%D1%86%D0%B8%D1%8F-%D1%81-%D0%B4%D1%80%D1%83%D0%B3%D0%B8%D0%BC%D0%B8-%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D1%8F%D0%BC%D0%B8)
- [8. Требования к безопасности](#8-%D0%A2%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BA-%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D0%B8)
- [9. Требования к тестированию](#9-%D0%A2%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BA-%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8E)
	- [9.1. Функциональное тестирование](#91-%D0%A4%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)
	- [9.2. Нагрузочное тестирование](#92-%D0%9D%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BE%D1%87%D0%BD%D0%BE%D0%B5-%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)
	- [9.3. Безопасностное тестирование](#93-%D0%91%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D0%BD%D0%BE%D0%B5-%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)
- [10. План реализации](#10-%D0%9F%D0%BB%D0%B0%D0%BD-%D1%80%D0%B5%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D0%B8)
	- [10.1. Этапы проекта](#101-%D0%AD%D1%82%D0%B0%D0%BF%D1%8B-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B0)
	- [10.2. Сроки и ресурсы](#102-%D0%A1%D1%80%D0%BE%D0%BA%D0%B8-%D0%B8-%D1%80%D0%B5%D1%81%D1%83%D1%80%D1%81%D1%8B)
- [11. Дополнительные замечания](#11-%D0%94%D0%BE%D0%BF%D0%BE%D0%BB%D0%BD%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5-%D0%B7%D0%B0%D0%BC%D0%B5%D1%87%D0%B0%D0%BD%D0%B8%D1%8F)
	- [11.1. Инициальный список доступов](#111-%D0%98%D0%BD%D0%B8%D1%86%D0%B8%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9-%D1%81%D0%BF%D0%B8%D1%81%D0%BE%D0%BA-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%BE%D0%B2)
	- [11.2. Соответствие между ролями и доступами](#112-%D0%A1%D0%BE%D0%BE%D1%82%D0%B2%D0%B5%D1%82%D1%81%D1%82%D0%B2%D0%B8%D0%B5-%D0%BC%D0%B5%D0%B6%D0%B4%D1%83-%D1%80%D0%BE%D0%BB%D1%8F%D0%BC%D0%B8-%D0%B8-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0%D0%BC%D0%B8)
		- [Администраторы](#%D0%90%D0%B4%D0%BC%D0%B8%D0%BD%D0%B8%D1%81%D1%82%D1%80%D0%B0%D1%82%D0%BE%D1%80%D1%8B)
		- [Модераторы](#%D0%9C%D0%BE%D0%B4%D0%B5%D1%80%D0%B0%D1%82%D0%BE%D1%80%D1%8B)
		- [Студенты](#%D0%A1%D1%82%D1%83%D0%B4%D0%B5%D0%BD%D1%82%D1%8B)

## 1. Введение

### 1.1. Цель документа

Цель данного документа — определить требования и спецификации для разработки бэкенд-функционала модуля **"Доступы"** в рамках первого релиза цифрового сервиса по автоматизации системы регистрации посещений мероприятий в университете.

### 1.2. Область применения

Документ предназначен для команды разработчиков бэкенда и тестировщиков, участвующих в реализации модуля **"Доступы"**. Он описывает функциональные и нефункциональные требования, модели данных, спецификации API и другие аспекты, необходимые для разработки и интеграции модуля с остальной системой.

---

## 2. Общее описание

### 2.1. Перспектива продукта

Модуль **"Доступы"** обеспечивает управление доступами (permissions) пользователей системы. Он позволяет назначать и удалять доступы пользователям для контроля их доступа к различным функциям системы. Доступы являются заранее определенными и не могут быть созданы или удалены через систему. Модуль интегрируется с модулями **"Авторизация"** и **"Пользователи"**, обеспечивая гибкую и масштабируемую систему контроля доступа.

### 2.2. Основные функции модуля "Доступы"

- **Назначение доступов пользователям:**
  - Назначение одного или нескольких доступов пользователям.
- **Удаление доступов с пользователей:**
  - Удаление одного или нескольких доступов с пользователей.
- **Хранение и организация доступов:**
  - Поддержка фиксированного списка доступов, определяющих права на различные действия и ресурсы.
- **Интеграция с другими модулями:**
  - Предоставление необходимых интерфейсов для других модулей для получения доступов пользователей и реализации контроля доступа.
- **Подготовка к будущему функционалу:**
  - Проектирование модели данных и интерфейсов с учетом расширяемости, позволяющей в будущем добавлять новые функции без значительных изменений системы.

### 2.3. Классы пользователей

Хотя роли не реализованы в коде и система оперирует исключительно доступами (permissions), важно сохранить понимание реальных бизнес-процессов и различных типов пользователей, взаимодействующих с системой. Следующие классы пользователей помогают определить, какие доступы обычно назначаются разным типам пользователей.

- **Администраторы:**
  - **Описание:** Имеют полный контроль над системой, включая управление пользователями, доступами и другими ключевыми функциями.
  - **Назначаемые доступы:**
    - `MANAGE_ACCESSES`
    - `MANAGE_USERS`
    - `MANAGE_EVENTS`
    - `VIEW_REPORTS`
    - `UPGRADE_USERS`

- **Модераторы:**
  - **Описание:** Отвечают за проведение мероприятий и взаимодействие с участниками.
  - **Назначаемые доступы:**
    - `MANAGE_EVENTS`
    - `VERIFY_PARTICIPANTS`
    - `VIEW_USERS`
    - `VIEW_USER_DETAILS`

- **Студенты:**
  - **Описание:** Являются конечными пользователями системы, участвующими в мероприятиях.
  - **Назначаемые доступы:**
    - По умолчанию специальные доступы не назначаются. При необходимости могут быть добавлены дополнительные доступы с появлением новых функций (например, `REGISTER_FOR_EVENTS`).

**Примечание:** Эти роли не отражены в коде и используются исключительно для понимания бизнес-процессов и определения, какие доступы назначаются пользователям.

---

## 3. Функциональные требования

### 3.1. Управление назначением доступов

#### 3.1.1. Назначение доступа пользователю

- **Описание:**
  - Пользователи с доступом `MANAGE_ACCESSES` могут назначать один или несколько доступов другим пользователям для контроля их доступа к функционалу системы.

- **Требования:**
  - **Выбор `user_id` и `access_name`:**
    - Указать пользователя и доступ, который необходимо назначить.
  - **Добавление записи в таблицу `user_accesses`:**
    - Создать запись, связывающую пользователя с доступом.
  - **Проверка существования:**
    - Проверить наличие пользователя и доступа перед назначением.
    - Предотвратить дублирование, убедившись, что доступ еще не назначен пользователю.
  - **Обработка ошибок:**
    - Возвращать соответствующие сообщения об ошибках при попытке назначить уже существующий доступ или если пользователь или доступ не существуют.
  - **Интеграция с системой авторизации:**
    - Обеспечить, чтобы назначенные доступы распознавались механизмами авторизации в других модулях.

#### 3.1.2. Удаление доступа с пользователя

- **Описание:**
  - Пользователи с доступом `MANAGE_ACCESSES` могут удалять один или несколько доступов с других пользователей.

- **Требования:**
  - **Выбор `user_id` и `access_name`:**
    - Указать пользователя и доступ, который необходимо удалить.
  - **Удаление записи из таблицы `user_accesses`:**
    - Удалить запись, связывающую пользователя с доступом.
  - **Проверка существования:**
    - Проверить наличие пользователя и доступа перед удалением.
    - Убедиться, что у пользователя действительно есть данный доступ.
  - **Обработка ошибок:**
    - Возвращать соответствующие сообщения об ошибках при попытке удалить доступ, которого нет у пользователя, или если пользователь или доступ не существуют.

### 3.2. Интеграция с другими модулями

- **Описание:**
  - Модуль должен предоставлять необходимые интерфейсы для других модулей, таких как **"Авторизация"** и **"Пользователи"**, для получения доступов пользователей и реализации контроля доступа.

- **Требования:**
  - **Предоставление API или сервисов:**
    - Эндпоинты для проверки доступов пользователей.
  - **Обеспечение целостности данных:**
    - Поддерживать актуальность информации о доступах для корректных решений об авторизации.
  - **Безопасность:**
    - Защитить эндпоинты, связанные с доступами, соответствующей аутентификацией и авторизацией.
  - **Документирование:**
    - Предоставить четкую документацию интерфейсов для разработчиков других модулей.

---

## 4. Нефункциональные требования

### 4.1. Безопасность

- **Аутентификация и авторизация:**
  - Использовать надежные методы аутентификации (например, JWT-токены).
  - Реализовать контроль доступа на основе доступов (permissions).
- **Защита данных:**
  - Шифрование данных при передаче (SSL/TLS).
  - Безопасное хранение чувствительных данных в соответствии с лучшими практиками.
- **Соответствие требованиям:**
  - Соблюдать законодательные требования по защите персональных данных (например, GDPR).
- **Защита от уязвимостей:**
  - Реализовать защиту от распространенных веб-атак (SQL-инъекции, XSS, CSRF и т.д.).
  - Ограничить количество попыток выполнения операций для предотвращения атак грубой силы.

### 4.2. Производительность

- **Время отклика:**
  - Система должна отвечать в течение 2 секунд для стандартных операций.
- **Пропускная способность:**
  - Способность обрабатывать ожидаемую нагрузку с возможностью масштабирования.

### 4.3. Масштабируемость

- **Архитектура:**
  - Модульная архитектура для облегчения добавления новых функций.
  - Поддержка горизонтального и вертикального масштабирования.

### 4.4. Надежность и отказоустойчивость

- **Доступность:**
  - Система должна быть доступна не менее 99.9% времени.
- **Резервное копирование и восстановление:**
  - Регулярное резервное копирование базы данных.
  - Быстрые механизмы восстановления в случае сбоев.

### 4.5. Документирование

- **Код и API:**
  - Полная документация кода для облегчения понимания и поддержки.
  - Документация API (например, с использованием Swagger/OpenAPI).

---

## 5. Требования к данным

### 5.1. Модель данных

#### Таблица `accesses`

| Поле         | Тип данных | Описание                                       | Ограничения                                |
|--------------|------------|------------------------------------------------|--------------------------------------------|
| access_name  | VARCHAR    | Уникальное имя доступа (например, `MANAGE_USERS`) | PRIMARY KEY, UNIQUE, NOT NULL              |
| description  | TEXT       | Описание назначения доступа                    | NOT NULL                                   |

- **Примечание:** Таблица `accesses` содержит фиксированный список доступов, определенный на этапе разработки. Эти доступы определяют права на различные действия и ресурсы в системе.

#### Таблица `user_accesses`

| Поле        | Тип данных | Описание                                 | Ограничения                                                   |
|-------------|------------|------------------------------------------|---------------------------------------------------------------|
| user_id     | UUID       | Идентификатор пользователя               | FOREIGN KEY (ссылается на `users.user_id`), NOT NULL          |
| access_name | VARCHAR    | Имя доступа                              | FOREIGN KEY (ссылается на `accesses.access_name`), NOT NULL   |
| assigned_at | TIMESTAMP  | Дата и время назначения доступа          | DEFAULT CURRENT_TIMESTAMP, NOT NULL                           |
| updated_at  | TIMESTAMP  | Дата и время последнего обновления       | DEFAULT CURRENT_TIMESTAMP ON UPDATE, NOT NULL                 |

- **Примечание:** Таблица `user_accesses` реализует связь многие-ко-многим между пользователями и доступами. Она хранит информацию о том, какие доступы назначены каким пользователям.

### 5.2. Требования к базе данных

- **Производительность:**
  - Оптимизация запросов и использование индексов на часто запрашиваемых полях (например, `access_name`, `user_id`).
- **Целостность данных:**
  - Обеспечение ссылочной целостности между таблицами `users`, `accesses` и `user_accesses`.
  - Реализация ограничений на уровне базы данных для предотвращения дублирования и обеспечения согласованности данных.
- **Безопасность:**
  - Ограничение доступа к таблицам `accesses` и `user_accesses` только для авторизованных сервисов.
  - Использование ролей и привилегий базы данных для обеспечения политики безопасности.

---

## 6. Спецификация API

### 6.1. Эндпоинты для управления доступами

#### 6.1.1. Назначение доступа пользователю

- **Метод:** `POST`
- **URL:** `/api/v1/accesses/assign`
- **Заголовки:**
  - `Authorization: Bearer <access_token>`
  - `Content-Type: application/json`
- **Требуемый доступ:** `MANAGE_ACCESSES`
- **Тело запроса:**

  ```json
  {
    "user_id": "uuid_user",
    "access_name": "MANAGE_USERS"
  }
  ```

- **Действия:**
  - Проверить, что у вызывающего пользователя есть доступ `MANAGE_ACCESSES`.
  - Проверить существование `user_id` и `access_name`.
  - Убедиться, что доступ еще не назначен пользователю.
  - Назначить доступ пользователю, добавив запись в `user_accesses`.

- **Ответы:**
  - **200 OK**

    ```json
    {
      "user_id": "uuid_user",
      "assigned_accesses": ["MANAGE_USERS", "VIEW_USERS"]
    }
    ```

  - **400 Bad Request** (доступ уже назначен)

    ```json
    {
      "error": "Доступ уже назначен этому пользователю."
    }
    ```

  - **404 Not Found** (пользователь или доступ не найдены)

    ```json
    {
      "error": "Пользователь или доступ не найдены."
    }
    ```

  - **403 Forbidden** (недостаточно прав)

    ```json
    {
      "error": "Недостаточно прав для выполнения операции."
    }
    ```

#### 6.1.2. Удаление доступа с пользователя

- **Метод:** `DELETE`
- **URL:** `/api/v1/accesses/unassign`
- **Заголовки:**
  - `Authorization: Bearer <access_token>`
  - `Content-Type: application/json`
- **Требуемый доступ:** `MANAGE_ACCESSES`
- **Тело запроса:**

  ```json
  {
    "user_id": "uuid_user",
    "access_name": "MANAGE_USERS"
  }
  ```

- **Действия:**
  - Проверить, что у вызывающего пользователя есть доступ `MANAGE_ACCESSES`.
  - Проверить существование `user_id` и `access_name`.
  - Убедиться, что у пользователя есть данный доступ.
  - Удалить доступ у пользователя, удалив запись из `user_accesses`.

- **Ответы:**
  - **204 No Content**
  - **404 Not Found** (пользователь, доступ не найдены или доступ не назначен пользователю)

    ```json
    {
      "error": "Доступ не назначен этому пользователю или пользователь/доступ не найдены."
    }
    ```

  - **403 Forbidden** (недостаточно прав)

    ```json
    {
      "error": "Недостаточно прав для выполнения операции."
    }
    ```

### 6.2. Эндпоинты для получения информации о доступах

#### 6.2.1. Получение списка доступов

- **Метод:** `GET`
- **URL:** `/api/v1/accesses`
- **Заголовки:**
  - `Authorization: Bearer <access_token>`
- **Требуемый доступ:** `MANAGE_ACCESSES` или `VIEW_ACCESSES`
- **Параметры запроса (опционально):**
  - `access_name` — фильтрация по имени доступа.
  - `sort` — сортировка результатов (например, по `access_name`).
- **Действия:**
  - Проверить, что у вызывающего пользователя есть необходимый доступ.
  - Получить список доступов с применением фильтров и сортировки, если указаны.

- **Ответы:**
  - **200 OK**

    ```json
    [
      {
        "access_name": "MANAGE_USERS",
        "description": "Управление пользователями (создание, просмотр, редактирование, удаление)"
      },
      {
        "access_name": "VIEW_USERS",
        "description": "Просмотр списка пользователей"
      }
      // ... другие доступы
    ]
    ```

  - **403 Forbidden** (недостаточно прав)

    ```json
    {
      "error": "Недостаточно прав для выполнения операции."
    }
    ```

#### 6.2.2. Получение информации о доступе

- **Метод:** `GET`
- **URL:** `/api/v1/accesses/{access_name}`
- **Заголовки:**
  - `Authorization: Bearer <access_token>`
- **Требуемый доступ:** `MANAGE_ACCESSES` или `VIEW_ACCESSES`
- **Действия:**
  - Проверить, что у вызывающего пользователя есть необходимый доступ.
  - Получить информацию о указанном доступе.

- **Ответы:**
  - **200 OK**

    ```json
    {
      "access_name": "MANAGE_USERS",
      "description": "Управление пользователями (создание, просмотр, редактирование, удаление)"
    }
    ```

  - **404 Not Found** (доступ не найден)

    ```json
    {
      "error": "Доступ не найден."
    }
    ```

  - **403 Forbidden** (недостаточно прав)

    ```json
    {
      "error": "Недостаточно прав для выполнения операции."
    }
    ```

#### 6.2.3. Получение текущих доступов пользователя

- **Метод:** `GET`
- **URL:** `/api/v1/users/{user_id}/accesses`
- **Заголовки:**
  - `Authorization: Bearer <access_token>`
- **Требуемый доступ:** `MANAGE_USERS` или если запрашивающий пользователь получает свои собственные доступы.
- **Действия:**
  - Если запрашиваются собственные доступы, разрешить доступ.
  - Если запрашиваются доступы другого пользователя, проверить наличие доступа `MANAGE_USERS`.
  - Получить список доступов, назначенных указанному пользователю.

- **Ответы:**
  - **200 OK**

    ```json
    {
      "user_id": "uuid_user",
      "accesses": [
        {
          "access_name": "MANAGE_USERS",
          "description": "Управление пользователями (создание, просмотр, редактирование, удаление)"
        },
        {
          "access_name": "VIEW_REPORTS",
          "description": "Просмотр отчетов системы"
        }
      ]
    }
    ```

  - **404 Not Found** (пользователь не найден)

    ```json
    {
      "error": "Пользователь не найден."
    }
    ```

  - **403 Forbidden** (недостаточно прав)

    ```json
    {
      "error": "Недостаточно прав для выполнения операции."
    }
    ```

### 6.3. Аутентификация и авторизация

- **Описание:**
  - Все эндпоинты модуля **"Доступы"** защищены механизмами аутентификации и авторизации, предоставляемыми модулем **"Авторизация"**.
  - Доступ к эндпоинтам осуществляется только при наличии действительного JWT-токена и необходимых доступов (permissions).
  - Модуль обеспечивает, чтобы только пользователи с соответствующими доступами могли выполнять действия, связанные с управлением доступами.

---

## 7. Архитектурные решения

### 7.1. Модульная архитектура

- **Модульность:**
  - Модуль **"Доступы"** разработан как отдельный модуль в рамках монолитного приложения, с четко определенными интерфейсами для взаимодействия с другими модулями.
- **Стандарты:**
  - Соблюдение RESTful стандартов при разработке API.
  - Использование стандартных методов HTTP (GET, POST, DELETE, PUT).

### 7.2. Интеграция с другими модулями

- **С модулем "Авторизация":**
  - Модуль **"Авторизация"** использует доступы, назначенные пользователям, для контроля доступа к различным функциям системы.
  - Назначение доступа `UPGRADE_USERS` позволяет пользователям использовать эндпоинт `/api/v1/auth/upgrade`.

- **С модулем "Пользователи":**
  - Управление пользователями осуществляется на основе доступов, таких как `MANAGE_USERS`, `VIEW_USERS`, `EDIT_USERS` и т.д.
  - Обеспечена согласованность в описании контроля доступа к эндпоинтам управления пользователями.

- **Изоляция данных:**
  - Каждый модуль управляет своими данными и предоставляет только необходимые интерфейсы для доступа.
  - Взаимодействие между модулями осуществляется через четко определенные API.

---

## 8. Требования к безопасности

- **Контроль доступа:**
  - Реализовать проверку доступов для каждого эндпоинта на основе доступов пользователя.
  - Ограничить доступ к эндпоинтам управления доступами только для пользователей с доступом `MANAGE_ACCESSES`.

- **Шифрование данных:**
  - Обеспечить шифрование всех передаваемых данных с использованием SSL/TLS.
  - Безопасно хранить чувствительные данные, следуя лучшим практикам по шифрованию и хешированию.

- **Защита от атак:**
  - Реализовать защиту от распространенных веб-атак (SQL-инъекции, XSS, CSRF и т.д.).
  - Ограничить количество попыток выполнения операций для предотвращения атак грубой силы.

- **Логирование и аудит:**
  - Вести журналы всех операций, связанных с управлением доступами.
  - Обеспечить защиту журналов от несанкционированного доступа и изменений.

---

## 9. Требования к тестированию

### 9.1. Функциональное тестирование

- **Назначение доступов:**
  - Проверка корректности назначения доступов пользователям.
  - Проверка корректности удаления доступов с пользователей.

- **Бизнес-логика:**
  - Тестирование уникальности доступов.
  - Тестирование ограничений при назначении доступов согласно бизнес-правилам.

- **Обработка ошибок:**
  - Тестирование обработки некорректных входных данных.
  - Тестирование ответов при попытке выполнения операций без необходимых доступов.

### 9.2. Нагрузочное тестирование

- **Производительность:**
  - Оценка времени отклика системы под стандартной и повышенной нагрузкой.
  - Проверка устойчивости системы при пиковых нагрузках.

- **Масштабируемость:**
  - Тестирование работы системы при увеличении объемов данных (например, большое количество пользователей и назначений доступов).

### 9.3. Безопасностное тестирование

- **Тестирование на уязвимости:**
  - Проверка на наличие SQL-инъекций, XSS, CSRF и других распространенных веб-уязвимостей.

- **Аутентификация и авторизация:**
  - Убедиться, что только авторизованные пользователи с необходимыми доступами могут выполнять операции.

- **Защита данных:**
  - Проверка безопасности передачи и хранения данных.

- **Защита от атак грубой силы:**
  - Тестирование механизмов, предотвращающих атаки грубой силы на систему.

---

## 10. План реализации

### 10.1. Этапы проекта

1. **Проектирование:**
   - Разработка модели данных для управления доступами.
   - Определение структуры API и схемы взаимодействия с другими модулями.

2. **Разработка:**
   - Реализация эндпоинтов для назначения и удаления доступов.
   - Реализация эндпоинтов для получения информации о доступах.
   - Интеграция с модулем **"Авторизация"** для проверки доступов.
   - Обеспечение согласованной интеграции с модулем **"Пользователи"**.

3. **Тестирование:**
   - Проведение функционального тестирования всех компонентов модуля.
   - Нагрузочное тестирование для оценки производительности.
   - Безопасностное тестирование для выявления и устранения уязвимостей.

4. **Документирование:**
   - Подготовка технической документации для разработчиков.
   - Документирование API с использованием инструментов вроде Swagger/OpenAPI.

5. **Внедрение:**
   - Развертывание модуля в тестовой среде.
   - Интеграция с другими модулями системы.
   - Подготовка к переносу в продакшн.

### 10.2. Сроки и ресурсы

- **Ориентировочные сроки:**
  - Общая продолжительность разработки модуля **"Доступы"**: 3 недели.

- **Команда проекта:**
  - **Backend-разработчики:** 2 человека.
  - **Тестировщики:** 1-2 человека.
  - **Бизнес-аналитик:** 1 человек (при необходимости для уточнения требований).
  - **Специалист по безопасности:** 1 человек (при необходимости для проведения безопасностного тестирования).

---

## 11. Дополнительные замечания

### 11.1. Инициальный список доступов

Представлен фиксированный список доступов, используемых в системе. Эти доступы заранее определены на этапе разработки и не могут быть созданы или удалены через систему. В процессе работы системы можно лишь назначать или удалять эти доступы пользователям.

1. **MANAGE_ACCESSES** — Управление доступами пользователей.
2. **MANAGE_USERS** — Управление пользователями (создание, просмотр, редактирование, удаление).
3. **VIEW_USERS** — Просмотр списка пользователей.
4. **VIEW_USER_DETAILS** — Просмотр подробной информации о пользователе.
5. **EDIT_USERS** — Редактирование информации о пользователях.
6. **DELETE_USERS** — Удаление пользователей.
7. **UPGRADE_USERS** — Добавление логина и пароля пользователям через эндпоинт `/api/v1/auth/upgrade`.
8. **MANAGE_EVENTS** — Управление мероприятиями.
9. **VERIFY_PARTICIPANTS** — Верификация участников мероприятий.
10. **VIEW_REPORTS** — Просмотр отчетов.

**Примечание:** Этот список фиксирован и задается на этапе разработки. Любое расширение функциональности системы, требующее новых доступов, должно быть запланировано и внесено в фиксированный список с соответствующими обновлениями документации и системы.

### 11.2. Соответствие между ролями и доступами

Хотя роли не реализованы в коде, понимание соответствия между типичными ролями пользователей и доступами помогает в управлении назначением доступов.

#### Администраторы

- **Описание:**
  - Имеют полный контроль над системой, включая управление пользователями, доступами и другими ключевыми функциями.

- **Назначаемые доступы:**
  - `MANAGE_ACCESSES`
  - `MANAGE_USERS`
  - `MANAGE_EVENTS`
  - `VIEW_REPORTS`
  - `UPGRADE_USERS`

#### Модераторы

- **Описание:**
  - Отвечают за проведение мероприятий и взаимодействие с участниками.

- **Назначаемые доступы:**
  - `MANAGE_EVENTS`
  - `VERIFY_PARTICIPANTS`
  - `VIEW_USERS`
  - `VIEW_USER_DETAILS`

#### Студенты

- **Описание:**
  - Являются конечными пользователями системы, участвующими в мероприятиях.

- **Назначаемые доступы:**
  - По умолчанию специальные доступы не назначаются.
  - При необходимости могут быть добавлены дополнительные доступы с появлением новых функций (например, `REGISTER_FOR_EVENTS`).
